// Generated by CoffeeScript 1.4.0
var Knax, i;

require('fing');

i = require('inflection');

module.exports = Knax = {
  load: function(definition) {
    var caller, directory, module, path;
    if (typeof definition.category !== 'undefined') {
      path = '.';
      caller = fing.trace()[1];
      if (typeof caller !== 'undefined') {
        path = require('path').dirname(caller.file);
      }
      directory = "" + path + "/" + (i.pluralize(definition.category));
      if (!definition["class"]) {
        throw 'local plugin requires category and class';
      }
      try {
        module = "" + directory + "/" + definition["class"];
        return require(module);
      } catch (error) {
        if (error.code === 'MODULE_NOT_FOUND') {
          return Knax.loadNested(definition, error);
        }
        throw error;
      }
    }
  },
  loadNested: function(definition, error) {
    console.log('TODO: loadNested');
    throw error;
  }
};
